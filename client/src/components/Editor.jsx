import React, { useState, useEffect } from "react";
import { themes } from "../utils";
import Editor from "@monaco-editor/react";
import { useLocalStorage } from "../hooks/useLocalStorage";

const CodeEditorWindow = ({ file }) => {
  const [copied, setCopied] = useState(false);
  const [theme, setTheme] = useLocalStorage("EDITOR_THEME", "vs-dark"); // Default theme is "light"

  const handleCopyContent = () => {
    navigator.clipboard.writeText(file.content);
    setCopied(true);
    setTimeout(() => {
      setCopied(false);
    }, 2000);
  };
  useEffect(() => {
    // Get the theme value from local storage
    const storedTheme = localStorage.getItem("theme");
    const themeObject = themes.find((theme) => theme.theme === storedTheme);
    if (themeObject) {
      setTheme(themeObject.preferred);
    }
  }, [localStorage.getItem("theme")]);

  const handleDownload = () => {
    const element = document.createElement("a");
    const fileContent = file.content;
    const fileName = file.name.endsWith(".py") ? file.name : `${file.name}.py`;
    const fileBlob = new Blob([fileContent], { type: "text/plain" });
    element.href = URL.createObjectURL(fileBlob);
    element.download = fileName;
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
  };
  return (
    <div className="overlay relative h-full w-full">
      <div className="absolute top-0 flex gap-3 right-0 z-20 p-2 rounded-bl-md shadow border-r border-base-200 bg-base-100">
        <div className="tooltip" data-tip="Download file">
          <button onClick={handleDownload} className="btn h-auto">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              strokeWidth={1.5}
              stroke="currentColor"
              className="w-6 h-6"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
              />
            </svg>
          </button>
        </div>
        <div
          className="tooltip"
          data-tip={copied ? "Copied to clipboard !" : "Copy content"}
        >
          <button onClick={handleCopyContent} className="btn h-auto">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              strokeWidth={1.5}
              stroke="currentColor"
              className="w-6 h-6"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"
              />
            </svg>
          </button>
        </div>
      </div>
      <Editor
        options={{ minimap: { enabled: false } }}
        path={file.name}
        defaultLanguage={file.language}
        value={file.content}
        theme={theme}
        height="100%"
        width={`100%`}
        defaultValue="# This file is empty or could not be decompiled."
      />
    </div>
  );
};
export default CodeEditorWindow;
