import logging
import os
import subprocess


def extract_and_analyse():
    # Directory where the malicious PE files are located
    files_directory = os.path.join(".", "inputs")
    extracted_files = []
    # Create the output directory if it doesn't exist
    os.makedirs(files_directory, exist_ok=True)

    # Configure logging
    logging.basicConfig(level=logging.INFO)

    # Iterate over the files in the input directory
    for filename in os.listdir(files_directory):
        # Perform decompilation for .pyc files
        # Decompilation using python-uncompyle6
        res = subprocess.run(["./pycdc/pycdc", os.path.join(files_directory, filename)],
                             stdout=subprocess.PIPE, stderr=subprocess.PIPE)

        # Write the decompiled content to a file
        decompiled_content = res.stdout.decode("utf-8")
        decompiled_filename = os.path.splitext(filename)[0] + ".py"
        decompiled_file_path = os.path.join(
            files_directory, decompiled_filename)
        with open(decompiled_file_path, "w") as f:
            f.write(decompiled_content)
        extracted_files.append(decompiled_filename)
    return extracted_files
